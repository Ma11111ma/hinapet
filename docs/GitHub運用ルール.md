# チーム開発用 GitHub 運用ルール

このドキュメントは、チーム全員が同じルールで開発を進めるための基本規約です。  
全員がこのルールに沿ってブランチ運用・コミット・レビュー・マージを行ってください。

---

## 1. ブランチ命名規則

| 種別         | 命名形式                                | 用途例                           |
| ------------ | --------------------------------------- | -------------------------------- |
| 機能追加     | `feature/{担当者名}/{Issue番号}-{概要}` | `feature/mai/12-map-pin-display` |
| バグ修正     | `fix/{担当者名}/{Issue番号}-{概要}`     | `fix/waka/18-login-error`        |
| 設定・ツール | `chore/{担当者名}/{概要}`               | `chore/miki/eslint-setup`        |
| ドキュメント | `docs/{担当者名}/{概要}`                | `docs/harumu/readme-update`      |
| テスト関連   | `test/{担当者名}/{概要}`                | `test/mai/e2e-auth`              |

**ルール**

- 基本小文字とハイフン（`-`）を使用する。
- ブランチ名は短く・意味がわかるようにする。
- 作業開始時は必ず `main` を`git pull origin main`で最新化してからブランチを切る。
- ブランチ作成コマンドは以下の通り：
  ```bash
  git checkout -b feature/mai/12-map-pin-display
  ```
  ※ `git switch -c` でも同様の結果になりますが、  
  多くの教材・チュートリアル・既存プロジェクトが `git checkout -b` を用いているため、  
  チーム内での混乱を避けるためこちらを採用しています。

---

## 2. コミットコメントルール

| 種別             | プレフィックス | 内容例                                             |
| ---------------- | -------------- | -------------------------------------------------- |
| 機能追加         | `feat:`        | `feat: 地図APIと避難所ピン表示を実装`              |
| バグ修正         | `fix:`         | `fix: shelter一覧が正しく表示されない不具合を修正` |
| スタイル変更     | `style:`       | `style: UIデザイン統一（ボタン配色変更）`          |
| リファクタリング | `refactor:`    | `refactor: useSheltersを共通化`                    |
| テスト追加・修正 | `test:`        | `test: shelters APIのレスポンスを検証`             |
| 設定・依存管理   | `chore:`       | `chore: Dockerfileと.envを更新`                    |
| ドキュメント修正 | `docs:`        | `docs: チーム開発ルールを追記`                     |

**ルール**

- コミットコメントは「何をしたのか」が一目で分かるように簡潔に書く。
- 英語・日本語どちらでも可。ただし混在は避ける。
- 1 つのコミットで複数目的を混ぜない。

**補足**

- **プレフィックス**（prefix）とは「接頭語」の意味です。  
  コミット内容の種類を明確にするため、文頭に付けます。
- `feat:` のような英語の接頭語を使った後は、日本語で内容を記述しても問題ありません。  
  → 「英語・日本語どちらでも可。ただし混在は避ける」とは、  
  **1 つの文の中で両言語を無理に混ぜない**という意味です。  
  （例：✅ `feat: shelters API のレスポンスを検証` は OK／❌ `feat: add 検証 API` は NG）
- コミット前の基本操作：
  ```bash
  git add .
  git commit -m "feat: shelters API のレスポンスを検証"
  ```

---

## 3. プルリクエスト（PR）作成手順

1. `main` ブランチを最新に更新する

   ```bash
   git pull origin main
   ```

2. 変更をステージングしてコミットする

   ```bash
   git add .
   git commit -m "feat: shelters API のレスポンスを検証"
   ```

3. 作業ブランチをリモートへプッシュする

   ```bash
   git push origin {ブランチ名}
   ```

4. GitHub 上で Pull Request（PR）を作成する。

5. PR タイトルは以下のフォーマットに従う。

   ```
   [種別] #Issue番号 - 概要
   例： [feature] #12 - 避難所ピン表示機能を追加
   ```

6. PR 本文（description）は次のテンプレートを使用する（下記「4. PR Description テンプレート」）。

---

## 4. PR Description テンプレート

以下をコピーして PR の本文に貼り付けてください。

```md
### Issue

- 関連 Issue 番号: #（例: #12）

### 概要

- この PR の目的や変更内容を簡潔に記載してください。

### 変更内容

- [ ] 新規ファイル作成:
- [ ] 既存ファイル修正:
- [ ] その他:

### 確認方法

1. ローカルでブランチをチェックアウト
2. 起動手順や必要なコマンド
3. 動作確認手順を明記（例：地図にピンが表示されることを確認）

### 確認してほしいポイント

- レビュー時確認してほしいポイント（型・ロジック・UI など）を記載

### 注意事項（任意）

- API キーや環境変数は `.env` 管理とし、Git に含めないこと
- UI 変更時はスクリーンショットを添付するとなお良い

### クローズ対象 issue の書き忘れ注意！

Closes #[issue 番号]
```

**レビュワー指定**

- 少なくとも 1 名以上のレビュワーを指定する（基本は　わけちゃん ↔️ MAI ／ MIKI ↔️ HARUMU）。

---

## 5. レビュワーがローカルで PR 内容を確認する方法

1. GitHub の PR ページで対象ブランチ名を確認する。
2. ローカルで以下を実行し、対象ブランチを取得・切替。
   ```bash
   git fetch origin {ブランチ名}
   git checkout {ブランチ名}
   ```
3. 起動して動作確認（例：`npm run dev` または `docker compose up`）。
4. コード確認後、GitHub 上で「Approve」または「Request changes」でレビュー結果を送信する。
5. **（マージ後）ローカル側でブランチを削除する場合**
   ```bash
   git branch -d {ブランチ名}
   git fetch -p
   ```
   ※ マージ前は削除しないように注意してください（レビュー作業が継続できなくなります）。

---

## 6. レビュー方法

**確認項目**

- 不要な `console.log` やコメントが残っていないか。
- 関数の命名や責務の分離が適切か。（特に `user` と `users` のような単数・複数の扱い）
- エラー処理・バリデーションが抜けていないか。
- UI の整合性・アクセシビリティに問題がないか。

**レビューコメントの書き方（2 種類）**

| コメント場所                                    | 内容例                                                                                                            | 目的                                           |
| ----------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- | ---------------------------------------------- |
| **ファイル内コメント**                          | 「この関数は共通化できそうです」／「命名をもう少し具体的にしても良いと思います」                                  | コードの特定行について具体的に改善提案を伝える |
| **Review 全体コメント欄（Finish Review 画面）** | 「全体的に構成が整理されており、UI 確認も問題なしです。」／「API 動作は OK ですが、変数名の統一をお願いします。」 | 全体的な評価・補足・承認/差戻し理由をまとめる  |

- コメント後、「Finish your review」→ OK なら**Approve** 確認してほしい場合は **Request changes** を選択。
- 「Comment」モードではレビューは確定されません（変更するほどではないけど、ちょっとした提案やコメント書き込みだけしたいときに使用）。

---

## 7. マージ方法

1. レビュワーが **Approve 済み** であることを確認。
2. リーダーが GitHub 上で「Merge pull request」を実行。
3. マージ方法は **Squash and merge** を基本とする（履歴を整理）。
4. マージ完了後、対象ブランチを削除する。

---

## 8. 次の作業に入る方法

1. `main` ブランチに戻る。
   ```bash
   git checkout main
   ```
2. 最新状態を取得。
   ```bash
   git pull origin main
   ```
3. 新しい Issue を確認し、対応するブランチを作成。
   ```bash
   git checkout -b feature/{担当者名}/{Issue番号}-{概要}
   ```

---

## 9. PR 作成者がマージを待たずに次の作業を始める方法

1. 作業中の PR ブランチを残したまま `main` に切り替える。
2. `main` を最新化する。
3. 新しいブランチを切って次の作業を開始する。
   ```bash
   git checkout main
   git pull origin main
   git checkout -b feature/mai/15-route-display
   ```
4. 依存関係がある場合は、マージ後に差分を再調整する。

---

## 10. コンフリクトが起きた場合の対処方法

1. 最新の `main` を取得。
   ```bash
   git pull origin main
   ```
2. コンフリクト発生ファイルを確認。
   ```bash
   git status
   ```
3. 該当ファイルを開き、`<<<<<<<`, `=======`, `>>>>>>>` の間を手動で修正。
4. 修正後にコミット。
   ```bash
   git add .
   git commit -m "fix: コンフリクト解消"
   ```
5. 再度プッシュして PR を更新。
   ```bash
   git push origin {ブランチ名}
   ```

---

## 11. その他注意点

- `.env` など機密情報は **絶対に Git に含めない**。
- `main` への直接 push は禁止。必ず PR 経由でマージする。
- コンフリクトやビルドエラーを放置しない。
- PR タイトル・説明・コミットメッセージは履歴として残る前提で丁寧に記載する。
- 各 Issue とブランチ対応を明確に管理する。

---

## 12. 運用フローまとめ

1. Issue 確認 → 自分の担当 Issue を着手
2. ブランチ作成 → 作業実装
3. コミット・プッシュ → PR 作成
4. レビュー依頼 → 承認後マージ
5. `main` 更新 → 次の Issue へ移行
