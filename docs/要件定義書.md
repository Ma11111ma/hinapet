## 要件定義

### 1. ドキュメント情報

- **ドキュメント名**：要件定義
- **作成日**：2025/10/9
- **作成者**：Mai
- **バージョン履歴**：v1

### 2. プロジェクト概要

- **システム名**：ペット同行避難支援アプリ
- **システムの目的・背景**：
  災害発生時に、ペットを飼っている住民が「どこに避難できるか」「同行・同伴可能な避難所はどこか」「混雑状況はどうか」を迅速に把握できるようにするための情報提供・行動支援アプリです。
  現状、ペット同行避難情報は自治体ごとに PDF・紙・散在した Web ページなどに存在し、即時アクセスや検索が困難です。さらに、避難所の混雑状況や開設状況がリアルタイムに把握できないため、住民側・自治体側双方で混乱が発生しています。
  本システムは、
  **地図ベースで同行・同伴・分離避難所を可視化**
  し、現在地やキーワードで検索、ルート表示を可能にするとともに、自治体側の管理画面からオープン・クローズ／混雑状況をリアルタイム反映できるようにします。
- **関係者**：
  - 講師：
  - 開発チーム：4 名

---

### 3. 用語定義

| 用語           | 定義                                                                          |
| -------------- | ----------------------------------------------------------------------------- |
| 同行避難       | 飼い主とペットが一緒に避難し、避難所の建物内に共に滞在する形態                |
| 同伴避難       | 飼い主とペットが一緒に避難するが、避難所建物の屋外や別室でペットを預かる形態  |
| 分離避難       | 飼い主とペットが別々に避難する形態（ペットは別施設に預ける）                  |
| 避難所種別     | 同行／同伴のいずれかを示す分類。今回のアプリでは分離避難先は対象外とする      |
| プレミアム登録 | 有料機能（健康チェックリストやリマインダー等）の利用登録。Stripe 決済を利用。 |

---

### 4. 業務フロー（As-Is / To-Be）

- **現在の業務（As-Is）**：
  - 避難所情報は自治体の PDF や紙資料に掲載されており、発災時に住民が即座に確認するのは難しい。
  - ペット同行避難情報は自治体ごとにバラバラで、検索・絞り込み・ルート案内ができない。
  - 混雑情報は現場や電話などで確認するしかなく、住民・自治体間の情報共有が遅れる。
- **新システムでの業務フロー（To-Be）**：
  - 住民はアプリにアクセスし、現在地やキーワードから避難所を検索。同行／同伴／分離別にマーカーで可視化。
  - 避難所のオープン・クローズ／混雑状況は自治体が管理画面から更新し、即時にアプリへ反映。
  - プレミアム機能で持ち物チェックリストや健康観察・リマインダーも利用可能。

---

### 5. 機能要件

| ID     | 機能名               | 概要                                         | 詳細仕様                                                 |
| ------ | -------------------- | -------------------------------------------- | -------------------------------------------------------- |
| FR-001 | 認証機能             | ユーザーがログインできる                     | Firebase によるメール・Google・LINE 認証対応             |
| FR-002 | 地図検索機能         | 施設名・距離・カテゴリ・お気に入りで検索可能 | 同行／同伴を色分けピンで可視化、ルート検索・混雑情報表示 |
| FR-003 | 決済機能             | プレミアム登録の決済処理                     | Stripe Checkout／Elements 利用、登録・更新・解約対応     |
| FR-004 | 管理者画面           | 避難所情報の管理                             | Open/Close・混雑状況・緊急通報メッセージ配信             |
| FR-005 | ユーザー／ペット登録 | マイページで情報登録・更新                   | 飼い主／ペット情報の入力、証明書アップロード機能含む     |
| FR-006 | お気に入り登録       | よく使う避難所の保存                         | マップ・リスト連動、再訪時の自動ピックアップ             |

---

### 6. 非機能要件（10/9 時点未設定）

| 項目           | 内容                                |
| -------------- | ----------------------------------- |
| パフォーマンス | 応答時間 1 秒以内（95%以上）        |
| 可用性         | 月間稼働率 99.9%以上                |
| セキュリティ   | TLS 対応、OWASP Top10 対策          |
| 対応端末       | Chrome, Safari（最新 2 バージョン） |

---

### 7. 画面一覧・仕様

| 画面 ID | 画面名             | 概要                                               | 遷移元             | 遷移先                |
| ------- | ------------------ | -------------------------------------------------- | ------------------ | --------------------- |
| UI-001  | 地図検索画面       | トップページ。避難所・ルート検索／混雑状況表示     | トップ             | マイページ／詳細表示  |
| UI-002  | ログイン画面       | ログインのみ                                       | トップ／マイページ | 地図検索／マイページ  |
| UI-003  | 新規登録画面       | 新規登録のみ                                       | トップ／マイページ | 地図検索／マイページ  |
| UI-004  | マイページ         | 飼い主・ペット情報／お気に入り一覧／プレミアム登録 | トップ／ログイン   | Stripe 決済／詳細画面 |
| UI-005  | 管理者ログイン画面 | 自治体担当者用                                     | トップ             | 管理者画面            |
| UI-006  | 管理者編集画面     | 避難所登録・更新・緊急通報送信                     | 管理者ログイン     |                       |

> ✅ 入力項目、バリデーション条件、ボタン配置なども別途記載 or ワイヤーフレーム添付

memo

- 事前登録で避難所受付 QR 発行 →[宮崎県で事例](https://prtimes.jp/main/html/rd/p/000000002.000088474.html?utm_source=chatgpt.com)あり
- 分離避難所は市内にない。→google map の検索機能で補完。あえて「分離避難」を登録することはやめる。
- **同行避難することは、動物愛護の観点のみならず、放浪動物による危害防止や生活環境保全の観点からも必要であるため、避難所におけるペットとの同行避難にご理解をお願いいたします。← 自治体や国からも同行避難が推奨されている**
- UI 参考サイト：https://www.ipetclub.jp/fun/aomori-bousai/map
- ***

### 8. データ要件

- 主なデータ項目と型
- マスターデータ（例：ユーザー権限、カテゴリ一覧）
- 保存期間、整合性ルール
- 避難所データ（ID／名称／住所／種別／緯度経度／Open 状態／混雑状況）
- ユーザーデータ（ID／認証情報／プレミアムフラグ）
- ペットデータ（ID／種類／接種情報／証明書画像 URL）
- お気に入りデータ（ユーザー ID と避難所 ID のリレーション）
- Stripe 決済情報（subscription ID, status）

---

### 9. 外部連携・API 要件

| 外部サービス | 概要                   | 方法                   | 形式 |
| ------------ | ---------------------- | ---------------------- | ---- |
| Google Maps  | 地図・ルート・距離検索 | JS SDK／Directions API | JSON |
| Stripe       | 決済処理               | REST API               | JSON |
| Firebase     | 認証機能               | SDK                    | JSON |

---

### 10. 制約事項・前提条件

- 使用技術スタック：Next.js（フロント）、FastAPI（バックエンド）、Supabase（DB）、Stripe、Google Maps API、Firebase Auth
- 開発環境：ローカル（Docker Compose）＋ Render or Railway（API）＋ Vercel（フロント）
- 分離避難施設は市内に存在しないため、Google 検索補完のみ対応

---

### 11. リスクと対応方針

| リスク                                | 対応方針                                                      |
| ------------------------------------- | ------------------------------------------------------------- |
| 避難所 PDF の構造が自治体ごとに異なる | Python でテキスト抽出テンプレートを柔軟に設計／手動補正も許容 |
| データ移行時の不整合                  | ステージング環境でテスト投入と検証                            |
| ログイン方式の追加                    | 影響範囲を把握し、周知フローを準備                            |
| 混雑情報の更新遅延                    | 管理画面の UI を簡素化、自治体側の運用教育                    |
