# 📝 コーディング規約書（最終課題プロジェクト）

最終更新：2025/10/09

対象プロジェクト：ペット同行避難支援アプリ（Next.js × FastAPI）

---

## 📌 1. 目的

本規約は、チーム開発におけるコード品質の維持・開発効率の向上・レビューの円滑化を目的とする。

全員がこの規約に準拠してコーディング・コミット・PR を行う。

---

## 🌐 2. 共通ルール（全体）

| 項目         | 規約                                                                         |
| ------------ | ---------------------------------------------------------------------------- |
| 言語         | TypeScript（Next.js）, Python3（FastAPI）                                    |
| Linter       | ESLint + Prettier（フロント）／flake8 + black（バック）                      |
| 命名規則     | lowerCamelCase（JS/TS）、snake_case（Python）、PascalCase（React Component） |
| コメント     | 原則「なぜ」をコメントする。実装内容はコードで表現する                       |
| 定数         | マジックナンバーは禁止。`constants.ts` / `config.py`などに定義               |
| 環境変数     | `.env.local`（個人開発）と `.env`（共有）を分ける。`.env`は Git に含めない   |
| フォーマット | 保存時自動整形を有効にする（VSCode 推奨）                                    |

---

## 🧭 3. フロントエンド（Next.js / TypeScript）

### 3.1 ディレクトリ構成

```
/src
 ├─ components/      … 再利用可能なUIコンポーネント
 ├─ pages/           … ルーティング（Next.js）
 ├─ features/        … 機能単位でまとめる（例：auth, shelters, payments）
 ├─ hooks/           … 共通カスタムフック
 ├─ lib/             … 外部APIクライアント、ユーティリティ
 ├─ styles/          … グローバルCSS, Tailwind設定
 └─ types/           … TypeScript型定義

```

### 3.2 コーディングスタイル

- `useEffect` などの副作用フックは依存配列を正しく指定
- コンポーネントはできるだけ**関数コンポーネント＋ Hooks**で記述
- コンポーネントの 1 ファイルは**300 行以内**を目安に分割
- UI コンポーネントはロジックを含めず、props で受け取る
- API 通信は `lib/apiClient.ts` または `fetcher.ts` に共通化し、コンポーネントからは直接書かない

### 3.3 型定義

- API のレスポンス・リクエストは `types/api.ts` にまとめて定義
- `any` の使用は禁止。どうしても必要な場合はコメントで理由を明記

### 3.4 命名例

| 種別           | 命名例                                             |
| -------------- | -------------------------------------------------- |
| コンポーネント | `ShelterCard.tsx`, `LoginForm.tsx`                 |
| Hooks          | `useShelterSearch.ts`, `useAuth.ts`                |
| State          | `isLoading`, `selectedShelter`, `userInfo`         |
| ファイル名     | `shelter-list.tsx`, `map-utils.ts`（スネーク不可） |

---

## 🐍 4. バックエンド（FastAPI / Python）

### 4.1 ディレクトリ構成

```
/app
 ├─ main.py              … エントリポイント
 ├─ api/                 … ルーター層（/users, /shelters など）
 ├─ schemas/             … Pydanticスキーマ
 ├─ models/              … ORMモデル（SQLAlchemy）
 ├─ crud/                … DB操作関数
 ├─ core/                … 設定・認証・例外ハンドリング
 ├─ tests/               … 単体テスト（pytest）
 └─ utils/               … ユーティリティ関数

```

### 4.2 コーディングスタイル

- **1 ファイル 300 行以内**を目安に責務を分離
- 関数名・変数名は `snake_case`、クラス名は `PascalCase`
- エラーハンドリングは `try-except` を適切に配置。FastAPI の `HTTPException` を活用
- スキーマは `Request / Response` で別定義する（`schemas/user.py`など）

### 4.3 命名例

| 種別     | 命名例                                 |
| -------- | -------------------------------------- |
| 関数     | `get_user_by_id`, `create_shelter`     |
| 変数     | `user_id`, `shelter_list`, `is_active` |
| ファイル | `user.py`, `shelter.py`                |

---

## 🧪 5. テスト・品質管理

| 項目          | 規約                                                             |
| ------------- | ---------------------------------------------------------------- |
| 単体テスト    | Vitest（フロント）、pytest（バック）                             |
| E2E テスト    | Playwright（主要機能の経路テスト）                               |
| カバレッジ    | 主要機能で 80%以上を目指す（MVP では最低限検索・認証・地図表示） |
| Lint / Format | PR 時に CI で自動チェック（`npm run lint` / `black --check`）    |

---

## 🌿 6. Git 運用ルール

### 6.1 ブランチ命名規則

| 種別 | フォーマット                                 | 例                          |
| ---- | -------------------------------------------- | --------------------------- |
| 機能 | `feature/<user>/<issue-number>-<short-desc>` | `feature/mai/12-map-search` |
| 修正 | `fix/<user>/<issue-number>-<short-desc>`     | `fix/waka/21-auth-bug`      |
| 雑務 | `chore/<user>/<desc>`                        | `chore/miki/update-readme`  |

- `main` ブランチは常にデプロイ可能状態を保つ
- 作業は必ずブランチを切って PR → レビュー → マージする

### 6.2 コミットメッセージ

```
<type>(<scope>): <short summary>

例：
feat(map): add shelter pin color by type
fix(auth): correct Firebase token handling
chore(ci): add lint check to GitHub Actions

```

| type     | 用途                                 |
| -------- | ------------------------------------ |
| feat     | 機能追加                             |
| fix      | バグ修正                             |
| docs     | ドキュメント修正                     |
| style    | フォーマット修正（ロジック変更なし） |
| refactor | 構造・リファクタリング               |
| test     | テスト追加・修正                     |
| chore    | CI・設定・依存更新など               |

---

## 📝 7. 命名とコメントの考え方（共通）

- \*「誰が見てもわかる」\*\*変数名・関数名を意識する（省略語や略称を避ける）
- コメントは「なぜ（Why）」を書く。「何を（What）」はコードで表現する
- ドメイン特有の用語（同行・同伴・分離など）は命名・コメントともに**統一語彙**を使う

---

## 🚀 8. 開発フローまとめ

1. Issue を立てる → 担当者アサイン
2. ブランチを切る（命名規則遵守）
3. 実装 → テスト → コミット（規約遵守）
4. PR 作成 → レビュワーアサイン
5. CI が通ったらレビュー → 承認後に main へマージ
6. デプロイ → 動作確認
