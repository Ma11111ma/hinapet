# 🖥 画面設計書

> **目的**: Figma デザインをもとに、各画面の構成・動作仕様・関連 API を整理する。  
> **対象**: フロントエンド実装担当者／レビュー担当者  
> **最新版**: 2025/10/12  
> **Figma リンク**: [ペット災害時避難（Figma）](https://www.figma.com/design/7RUPf0lI1ZaFbjRZvDv2MI/%E3%83%9A%E3%83%83%E3%83%88%E7%81%BD%E5%AE%B3%E6%99%82%E9%81%BF%E9%9B%A3?node-id=0-1)

---

## 1. トップページ（地図検索画面 `/`）

| 項目     | 内容                                                                    |
| -------- | ----------------------------------------------------------------------- |
| 画面 ID  | P-001                                                                   |
| 画面名   | トップページ（避難所マップ検索）                                        |
| URL      | `/`                                                                     |
| 担当     | Frontend / Backend                                                      |
| 利用権限 | **全ユーザー利用可能（未ログインでも表示可）**                          |
| 目的     | 藤沢市内の避難所情報（同行／同伴／分離）をマップ上で可視化・検索する    |
| 関連 API | `/shelters`（GET）, `/favorites`（POST/DELETE）, Directions API（外部） |

### 🧩 UI 要素

| 要素名                    | 種類           | 内容                                     | 備考                                             |
| ------------------------- | -------------- | ---------------------------------------- | ------------------------------------------------ |
| Google Map コンポーネント | Map            | 避難所のピンを描画                       | ピン色＝受入形態（青＝同行、緑＝同伴、赤＝分離） |
| 検索バー                  | Input + Select | キーワード／種別で検索                   | `/shelters?type=` と連動                         |
| 凡例（legend）            | Component      | ピン色の説明                             | 固定表示                                         |
| 詳細モーダル              | Modal          | shelter 詳細（住所／対応種別）           | ピンクリックで開く                               |
| お気に入りボタン          | IconButton     | shelters.id を favorites に登録／解除    | **ログインユーザーのみ有効**                     |
| 現在地ボタン              | FloatingButton | Geolocation API で中心位置を現在地に変更 | スピナー表示あり                                 |

### ⚙️ 動作仕様

- ページ初回ロード時、`navigator.geolocation` で現在地取得
- `/shelters` API から避難所一覧を取得し、地図に描画
- ピン押下 → 詳細モーダル表示
- ログインしていない場合：
  - お気に入りボタン押下 → `/login` ページに遷移
- ログイン済みの場合：
  - `/favorites` API を呼び出し登録／解除
- 検索・カテゴリ変更時は API 再取得

---

## 2. ログインページ（`/login`）

| 項目     | 内容                                       |
| -------- | ------------------------------------------ |
| 画面 ID  | P-002                                      |
| 画面名   | ログインページ                             |
| URL      | `/login`                                   |
| 担当     | Frontend                                   |
| 利用権限 | 全ユーザー利用可（未ログイン時表示）       |
| 目的     | Firebase Authentication によるログイン処理 |
| 関連 API | Firebase Auth（外部）                      |

### 🧩 UI 要素

| 要素名             | 種類              | 内容                    | 備考                    |
| ------------------ | ----------------- | ----------------------- | ----------------------- |
| メールアドレス入力 | Input             | メール形式チェック      | 必須                    |
| パスワード入力     | Input（password） | 6 文字以上              | 必須                    |
| ログインボタン     | Button            | Firebase 認証を呼び出す | 成功時 `/mypage` へ遷移 |
| 新規登録リンク     | TextLink          | `/register` に遷移      | 下部に配置              |

### ⚙️ 動作仕様

- `signInWithEmailAndPassword()` で認証
- 成功時：JWT（ID トークン）を Cookie or ローカルに保存
- 失敗時：エラー表示（例：「メールアドレスまたはパスワードが違います」）
- ログイン済ユーザーがアクセスした場合 → `/mypage` にリダイレクト

---

## 3. 新規登録ページ（`/register`）

| 項目     | 内容                                                                   |
| -------- | ---------------------------------------------------------------------- |
| 画面 ID  | P-003                                                                  |
| 画面名   | 新規登録ページ                                                         |
| URL      | `/register`                                                            |
| 担当     | Frontend                                                               |
| 利用権限 | 全ユーザー利用可（未登録ユーザー対象）                                 |
| 目的     | Firebase Auth とバックエンド `/users` API を利用し、ユーザー登録を行う |
| 関連 API | Firebase Auth（外部）, `/users`（POST）                                |

### 🧩 UI 要素

| 要素名         | 種類              | 内容                         | バリデーション          |
| -------------- | ----------------- | ---------------------------- | ----------------------- |
| 氏名           | Input             | テキスト入力                 | 必須                    |
| メールアドレス | Input             | メール形式                   | 必須                    |
| パスワード     | Input（password） | 6 文字以上                   | 必須                    |
| 登録ボタン     | Button            | Firebase 登録＋`/users` 登録 | 成功時 `/mypage` へ遷移 |
| ログインリンク | TextLink          | `/login` に戻る              | 下部に配置              |

### ⚙️ 動作仕様

- 入力フォーム送信時、Firebase Auth に登録
- 成功後、バックエンド `/users` にユーザー登録
- バリデーションエラーは各フィールド下に表示
- 登録済みメールの場合はエラーメッセージを表示

---

## 4. マイページ（`/mypage`）

| 項目     | 内容                                                |
| -------- | --------------------------------------------------- |
| 画面 ID  | P-004                                               |
| 画面名   | マイページ                                          |
| URL      | `/mypage`                                           |
| 担当     | Frontend / Backend                                  |
| 利用権限 | **ログイン済ユーザーのみ**（Firebase Auth）         |
| 目的     | 登録ユーザーが飼い主・ペット情報を閲覧・編集できる  |
| 関連 API | `/users`（GET/PUT）, `/pets`（GET/POST/PUT/DELETE） |

### 🧩 UI 要素

| 要素名             | 種類   | 内容                         | 備考                   |
| ------------------ | ------ | ---------------------------- | ---------------------- |
| タブ切り替え       | Tabs   | 「飼い主情報」「ペット情報」 | 状態保持あり           |
| 飼い主情報フォーム | Form   | 氏名・電話番号・住所         | `/users` 更新          |
| ペット情報リスト   | List   | 登録済みペット一覧           | 各行に編集・削除ボタン |
| ペット追加ボタン   | Button | 新規登録モーダル表示         | `/pets` POST           |
| 保存ボタン         | Button | 入力データ送信               | 成功時 Snackbar 表示   |

### ⚙️ 動作仕様

- ページロード時に `/users` `/pets` 取得
- 認証なしでアクセスした場合 → `/login` にリダイレクト
- 飼い主情報フォームは自動入力（認証ユーザー情報）
- ペット追加・削除で即時リスト更新
- 保存時：PUT 送信＋トースト通知

---

## 共通コンポーネント一覧

| コンポーネント名 | 用途                             | 備考                                             |
| ---------------- | -------------------------------- | ------------------------------------------------ |
| Header           | ナビゲーション・ログイン状態表示 | 未ログイン時は「ログイン」「新規登録」ボタン表示 |
| Modal            | 詳細／登録フォーム用             | 背景クリックで閉じる                             |
| Snackbar         | 成功・エラー通知用               | Material UI ベース                               |
| Loader           | ローディングスピナー             | API 通信時に表示                                 |

---

## 補足情報

- 画面 ID は E2E テスト・PRD 参照時に共通利用
- すべての API は CORS 対応・Firebase トークン認証前提
- Figma 上で UI 変更が発生した際は、該当画面セクションを更新

---

📄 **保存場所**: `docs/画面設計書.md`  
📎 **参照元**: [Figma デザイン](https://www.figma.com/design/7RUPf0lI1ZaFbjRZvDv2MI/%E3%83%9A%E3%83%83%E3%83%88%E7%81%BD%E5%AE%B3%E6%99%82%E9%81%BF%E9%9B%A3?node-id=0-1)
