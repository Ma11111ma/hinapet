name: Full Stack CI (Frontend + Backend + DB)

on:
  pull_request:
    branches: [main, develop, feature/**]
  push:
    branches: [main]

jobs:
  # ==============================
  # ðŸŸ¦ Frontend CI
  # ==============================
  frontend:
    name: Frontend Lint & Build
    runs-on: ubuntu-latest

      env:
      FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
      FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
      FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
      FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
      FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
      FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
      FIREBASE_MEASUREMENT_ID: ${{ secrets.FIREBASE_MEASUREMENT_ID }}

    steps:
      # 1ï¸âƒ£ Checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Node.js setup
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: frontend/package-lock.json

      # 3ï¸âƒ£ Install dependencies
      - name: Install dependencies
        run: npm ci
        working-directory: frontend

      # 4ï¸âƒ£ Lint
      - name: Run lint
        run: npm run lint
        working-directory: frontend

      # 5ï¸âƒ£ Build
      - name: Build project
        run: npm run build
        working-directory: frontend

  # =======================================
  # ðŸŸ¥ Backend + DB CIï¼ˆå°†æ¥æœ‰åŠ¹åŒ–äºˆå®šï¼‰
  # =======================================
  # backend:
  #   name: Backend API & DB Integration
  #   runs-on: ubuntu-latest
  #   needs: frontend
  #
  #   services:
  #     db:
  #       image: postgis/postgis:15-3.4
  #       env:
  #         POSTGRES_USER: postgres
  #         POSTGRES_PASSWORD: maiwakeharumiki
  #         POSTGRES_DB: pet_db
  #       ports:
  #         - 5432:5432
  #       options: >-
  #         --health-cmd "pg_isready -U postgres"
  #         --health-interval 5s
  #         --health-timeout 5s
  #         --health-retries 5
  #
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  #
  #     - name: Setup Python
  #       uses: actions/setup-python@v5
  #       with:
  #         python-version: '3.11'
  #
  #     - name: Install dependencies
  #       run: pip install --no-cache-dir -r backend/requirements.txt
  #
  #     # Alembic migration
  #     - name: Run migrations
  #       run: alembic upgrade head
  #       working-directory: backend
  #
  #     # Backend test
  #     - name: Run backend tests
  #       run: pytest
  #       working-directory: backend
  #
  #     # Optional: Integration check (FastAPIèµ·å‹•ãƒ†ã‚¹ãƒˆ)
  #     # - name: Start backend service
  #     #   run: docker compose -f docker-compose.yml up --build -d
  #     #
  #     # - name: Wait for backend to respond
  #     #   run: |
  #     #     timeout 60 bash -c 'until curl -s http://localhost:8000/docs; do sleep 3; done'
  #     #
  #     # - name: Run API smoke test
  #     #   run: curl -f http://localhost:8000/shelters || exit 1
